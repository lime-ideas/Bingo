<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>90s Bingo</title>
    <style>
        body {
            font-family: sans-serif;
            text-align: center;
            padding: 20px;
        }

        table {
            margin: auto;
            border-collapse: collapse;
        }

        td {
            width: 100px;
            height: 100px;
            border: 1px solid #333;
            vertical-align: middle;
            text-align: center;
            cursor: pointer;
            background: #fff;
            user-select: none;
        }

        td.marked {
            background-color: lightgreen;
            text-decoration: line-through;
        }
    </style>
</head>
<body>
    <h1>90s Bingo Generator</h1>
    <button onclick="generateAndRedirect()">ðŸŽ² Get My Bingo Card</button>
    <p><small>Click the button to get your personalized bingo card and submit your info.</small></p>
    <table id="bingo" style="display: none;"></table>
    <div id="cardLinkContainer" style="margin-top: 20px; display: none;">
        <p>Here is your bingo card link: <a id="cardLink" href="#"></a></p>
        <p><small>Bookmark this link to return to your card.</small></p>
    </div>

    <script>
        const phrases = [
            "Ninja Turtles", "Clueless", "Rad", "Tamagotchi", "Spice Girls", "Beepers", "Grunge",
            "Titanic", "Blockbuster", "Furby", "Beanie Babies", "The Rachel", "Discman", "Boy Bands",
            "AIM", "Y2K", "Game Boy", "Pogs", "Fresh Prince", "Frosted Tips", "Napster", "TRL",
            "Butterfly Clips", "No Doubt", "Goosebumps", "SNICK", "Dial-up", "Saved by the Bell",
            "Lisa Frank", "Rugrats", "Flannel", "Troll Dolls", "My So-Called Life", "VHS", "WWF",
            "PokÃ©mon", "Mini Backpacks", "Gak", "MTV", "Clarissa", "Daria", "Skorts", "TLC", "N64",
            "Hypercolor", "Hacky Sack", "Nirvana", "T9 Texting", "Double Dare", "Power Rangers"
        ];

        const googleFormId = '1FAIpQLSdjka319ssYitGdQfoViq7BINnPwXgFsX6JEUzbG5kVuYvHig'; // Replace with your actual Form ID
        const bingoWordsEntryId = 'entry.1510045328'; // Replace with your Bingo Words entry ID

        function shuffle(array) {
            let a = [...array];
            for (let i = a.length - 1; i > 0; i--) {
                let j = Math.floor(Math.random() * (i + 1));
                [a[i], a[j]] = [a[j], a[i]];
            }
            return a;
        }

        function generateCard() {
            return shuffle(phrases).slice(0, 24);
        }

        function renderCard(selected) {
            const table = document.getElementById("bingo");
            table.innerHTML = "";
            let index = 0;

            for (let row = 0; row < 5; row++) {
                const tr = document.createElement("tr");
                for (let col = 0; col < 5; col++) {
                    const td = document.createElement("td");

                    if (row === 2 && col === 2) {
                        td.innerText = "FREE";
                        td.classList.add("marked");
                    } else {
                        td.innerText = selected[index];
                        index++;
                    }

                    td.addEventListener("click", () => {
                        td.classList.toggle("marked");
                        saveMarks();
                    });

                    tr.appendChild(td);
                }
                table.appendChild(tr);
            }
            document.getElementById("bingo").style.display = "table";
        }

        function saveMarks() {
            const cells = document.querySelectorAll("#bingo td");
            const state = Array.from(cells).map(td => td.classList.contains("marked"));
            localStorage.setItem(getCardId(), JSON.stringify(state));
        }

        function loadMarks() {
            const cells = document.querySelectorAll("#bingo td");
            const state = JSON.parse(localStorage.getItem(getCardId()) || "[]");
            state.forEach((mark, i) => {
                if (mark) cells[i].classList.add("marked");
            });
        }

        function getCardId() {
            // Simple way to generate a unique ID for the card in local storage
            return 'bingo_card_' + window.location.hash.substring(1);
        }

        function loadCardFromHash() {
            const hash = decodeURIComponent(location.hash.slice(1));
            try {
                const selected = JSON.parse(hash);
                if (Array.isArray(selected) && selected.length === 24) {
                    renderCard(selected);
                    loadMarks();
                    document.getElementById("cardLinkContainer").style.display = "block";
                    document.getElementById("cardLink").href = window.location.href;
                    document.getElementById("cardLink").innerText = window.location.href;
                } else {
                    // No valid card in hash, do nothing for now
                }
            } catch {
                // Error parsing hash, do nothing for now
            }
        }

        function generateAndRedirect() {
    const cardWords = generateCard();
    renderCard(cardWords); // Render the card *before* redirecting

    // Generate a hash and update the URL
    const encoded = encodeURIComponent(JSON.stringify(cardWords));
    window.location.hash = encoded;

    const prefilledUrl = `https://docs.google.com/forms/d/e/${googleFormId}/viewform?usp=pp_url&${bingoWordsEntryId}=${encodeURIComponent(cardWords.join(', '))}`;
    window.location.href = prefilledUrl; // *Then* redirect
}

        window.onload = loadCardFromHash;
    </script>
</body>
</html>
